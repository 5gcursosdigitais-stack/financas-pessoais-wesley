<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finan√ßas Wesley - PC + iPhone</title>
    <style>
        :root {
            --bg-primary: #f8fafc; --bg-secondary: #ffffff; --text-primary: #1e293b;
            --text-secondary: #64748b; --accent: #3b82f6; --success: #10b981;
            --warning: #f59e0b; --danger: #ef4444; --border: #e2e8f0; 
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1); --radius: 12px;
        }
        [data-theme="dark"] {
            --bg-primary: #0f172a; --bg-secondary: #1e293b; --text-primary: #f8fafc;
            --text-secondary: #94a3b8; --border: #334155;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary); color: var(--text-primary); line-height: 1.6; 
            transition: all 0.3s ease; padding-bottom: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
        .header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 2rem; padding: 1.5rem; background: var(--bg-secondary); 
            border-radius: var(--radius); box-shadow: var(--shadow);
        }
        .kpis { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .kpi-card { 
            background: var(--bg-secondary); padding: 1.5rem; border-radius: var(--radius); 
            box-shadow: var(--shadow); text-align: center; border-left: 4px solid var(--accent);
        }
        .kpi-value { font-size: 2rem; font-weight: bold; color: var(--accent); margin-bottom: 0.25rem; }
        .kpi-label { color: var(--text-secondary); font-size: 0.9rem; }
        .tabs { display: flex; background: var(--bg-secondary); border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); margin-bottom: 2rem; }
        .tab-btn { flex: 1; padding: 1rem; background: none; border: none; color: var(--text-secondary); cursor: pointer; transition: all 0.3s ease; font-size: 1rem; }
        .tab-btn.active { background: var(--accent); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-primary); }
        input, select { 
            width: 100%; padding: 0.75rem; border: 2px solid var(--border); border-radius: 8px; 
            font-size: 1rem; transition: border-color 0.3s ease; background: var(--bg-secondary); 
            color: var(--text-primary);
        }
        input:focus, select:focus { outline: none; border-color: var(--accent); }
        .table-container { background: var(--bg-secondary); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; margin-bottom: 1rem; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 1rem 0.75rem; text-align: left; border-bottom: 1px solid var(--border); }
        th { background: var(--accent); color: white; font-weight: 600; }
        .btn { 
            padding: 0.75rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; 
            font-size: 0.9rem; font-weight: 500; transition: all 0.3s ease; margin: 0 0.25rem 0.5rem 0;
        }
        .btn-primary { background: var(--accent); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: var(--shadow); }
        .chart-container { height: 280px; background: var(--bg-secondary); border-radius: var(--radius); padding: 1.5rem; margin-bottom: 2rem; box-shadow: var(--shadow); display: flex; align-items: center; justify-content: center; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .storage-status { padding: 0.75rem; border-radius: 8px; text-align: center; margin-bottom: 1rem; font-weight: 500; }
        .storage-ok { background: var(--success); color: white; }
        .storage-warning { background: var(--warning); color: white; }
        @media (max-width: 768px) { 
            .container { padding: 0.5rem; } 
            .header { flex-direction: column; gap: 1rem; text-align: center; } 
            .kpis { grid-template-columns: 1fr; } 
            .tabs { flex-direction: column; } 
            .grid-2 { grid-template-columns: 1fr; }
            th, td { padding: 0.75rem 0.5rem; font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- STATUS STORAGE -->
        <div class="storage-status storage-warning" id="storageStatus">üîÑ Verificando storage...</div>

        <!-- HEADER -->
        <header class="header">
            <h1>üí∞ Finan√ßas Pessoais</h1>
            <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="navegarMes(-1)">‚óÄÔ∏è Anterior</button>
                <span id="mesAtual" style="padding: 0.75rem 1rem; font-weight: bold; font-size: 1.1rem; min-width: 140px; text-align: center; background: var(--accent); color: white; border-radius: 8px;">Janeiro 2026</span>
                <button class="btn btn-primary" onclick="navegarMes(1)">Pr√≥ximo ‚ñ∂Ô∏è</button>
                <button class="btn btn-primary" id="themeBtn" onclick="toggleTheme()">üåô Dark</button>
            </div>
        </header>

        <!-- KPIs -->
        <div class="kpis">
            <div class="kpi-card">
                <div class="kpi-value" id="saldoAtual">R$ 0,00</div>
                <div class="kpi-label">Saldo Atual</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value" id="taxaPoupanca">0%</div>
                <div class="kpi-label">Taxa de Poupan√ßa</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value" id="patrimonioTotal">R$ 0,00</div>
                <div class="kpi-label">Patrim√¥nio Total</div>
            </div>
        </div>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="tab-btn" onclick="showTab('receitas')">üíµ Receitas</button>
            <button class="tab-btn" onclick="showTab('despesas')">üí∏ Despesas</button>
            <button class="tab-btn" onclick="showTab('investimentos')">üìà Investimentos</button>
        </div>

        <!-- DASHBOARD -->
        <div id="dashboard" class="tab-content active">
            <div class="grid-2">
                <div class="chart-container">
                    <canvas id="graficoDespesas" width="300" height="280"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="graficoPatrimonio" width="300" height="280"></canvas>
                </div>
            </div>
            <div style="text-align: center; padding: 2rem;">
                <button class="btn btn-primary" onclick="exportCSV()">üì• Exportar CSV</button>
                <button class="btn btn-danger" onclick="resetData()">üóëÔ∏è Resetar Tudo</button>
            </div>
        </div>

        <!-- RECEITAS -->
        <div id="receitas" class="tab-content">
            <div class="table-container">
                <table>
                    <thead><tr><th>Data</th><th>Descri√ß√£o</th><th>Valor (R$)</th><th>Tipo</th><th>A√ß√µes</th></tr></thead>
                    <tbody id="tabelaReceitas"></tbody>
                </table>
            </div>
            <div class="form-group">
                <input type="date" id="dataReceita" required>
                <input type="text" id="descReceita" placeholder="Ex: Sal√°rio Localiza" required>
                <input type="number" id="valorReceita" placeholder="0,00" step="0.01" required>
                <select id="tipoReceita">
                    <option value="salario">üíº Sal√°rio Fixo</option>
                    <option value="extra">‚≠ê Renda Extra</option>
                </select>
                <button class="btn btn-success" onclick="addReceita()">‚ûï Adicionar Receita</button>
            </div>
        </div>

        <!-- DESPESAS -->
        <div id="despesas" class="tab-content">
            <div class="table-container">
                <table>
                    <thead><tr><th>Data</th><th>Categoria</th><th>Descri√ß√£o</th><th>Valor (R$)</th><th>A√ß√µes</th></tr></thead>
                    <tbody id="tabelaDespesas"></tbody>
                </table>
            </div>
            <div class="form-group grid-2">
                <div>
                    <label>Data *</label>
                    <input type="date" id="dataDespesa" required>
                </div>
                <div>
                    <label>Categoria <span style="color: var(--accent);">(livre)</span></label>
                    <select id="categoriaDespesaSelect" onchange="toggleCustomCategoria()" style="width: 100%;">
                        <option value="">‚ûï Digite nova categoria</option>
                        <option value="moradia">üè† Moradia/Aluguel</option>
                        <option value="alimentacao">üçö Alimenta√ß√£o</option>
                        <option value="transporte">üöó Transporte</option>
                        <option value="lazer">üéâ Lazer</option>
                        <option value="saude">üè• Sa√∫de</option>
                        <option value="fitness">üí™ Academia</option>
                        <option value="localiza">üöô Localiza/Frota</option>
                    </select>
                    <input type="text" id="categoriaCustom" placeholder="Ex: mooca-aluguel, shopee..." style="display: none; margin-top: 0.5rem; border: 2px dashed var(--accent);">
                </div>
                <div>
                    <label>Descri√ß√£o *</label>
                    <input type="text" id="descDespesa" placeholder="O que foi gasto?" required>
                </div>
                <div>
                    <label>Valor (R$) *</label>
                    <input type="number" id="valorDespesa" placeholder="0,00" step="0.01" required>
                </div>
            </div>
            <button class="btn btn-success" onclick="addDespesa()">‚ûï Adicionar Despesa</button>
        </div>

        <!-- INVESTIMENTOS -->
        <div id="investimentos" class="tab-content">
            <div class="table-container">
                <table>
                    <thead><tr><th>Tipo</th><th>Aporte (R$)</th><th>Rentabilidade</th><th>Saldo Atual</th><th>Proje√ß√£o 1a</th><th>A√ß√µes</th></tr></thead>
                    <tbody id="tabelaInvestimentos"></tbody>
                </table>
            </div>
            <div class="form-group grid-2">
                <div>
                    <label>Tipo de Ativo</label>
                    <select id="tipoInvestimento">
                        <option value="renda-fixa">üîí Renda Fixa</option>
                        <option value="acoes">üìà A√ß√µes</option>
                        <option value="fundos">üí∞ Fundos</option>
                        <option value="cripto">‚Çø Criptomoedas</option>
                    </select>
                </div>
                <div><label>Aporte Inicial</label><input type="number" id="aporteInvestimento" step="0.01" required></div>
                <div><label>Rentabilidade %</label><input type="number" id="rentabilidade" step="0.1" placeholder="12.5" required></div>
                <div><label>Saldo Atual (R$)</label><input type="number" id="saldoAtualInv" step="0.01" required></div>
            </div>
            <button class="btn btn-success" onclick="addInvestimento()">‚ûï Adicionar Investimento</button>
        </div>
    </div>

    <script>
        // =====================================================
        // STORAGE FIX: PC + IPHONE + GitHub Pages
        // =====================================================
        class FinancasStorage {
            constructor() {
                this.prefix = `financas_wesley_${location.hostname}_${location.pathname.replace(/\//g,'_')}_v3`;
                this.init();
            }

            init() {
                // Testar localStorage primeiro
                try {
                    localStorage.setItem('test', '1');
                    localStorage.removeItem('test');
                    this.storage = localStorage;
                    this.type = 'localStorage';
                } catch(e) {
                    console.log('localStorage bloqueado, usando sessionStorage');
                    this.storage = sessionStorage;
                    this.type = 'sessionStorage';
                }
                this.atualizarStatus();
            }

            get(key) {
                try {
                    return JSON.parse(this.storage.getItem(`${this.prefix}_${key}`) || '{}');
                } catch(e) {
                    return {};
                }
            }

            set(key, data) {
                try {
                    this.storage.setItem(`${this.prefix}_${key}`, JSON.stringify(data));
                    return true;
                } catch(e) {
                    console.error('Storage falhou:', e);
                    return false;
                }
            }

            atualizarStatus() {
                const status = document.getElementById('storageStatus');
                status.textContent = `‚úÖ Storage: ${this.type} | Dispositivo: ${/iPhone|iPad/.test(navigator.userAgent) ? 'iPhone' : 'PC'}`;
                status.className = 'storage-status storage-ok';
            }
        }

        // =====================================================
        // VARI√ÅVEIS GLOBAIS
        // =====================================================
        const storage = new FinancasStorage();
        const mesesNomes = ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
        const hoje = new Date('2026-01-24');
        let mesSelecionado = `${hoje.getFullYear()}-${String(hoje.getMonth()+1).padStart(2,'0')}`;
        let receitas = [], despesas = [], investimentos = [];

        // =====================================================
        // FUN√á√ïES PRINCIPAIS
        // =====================================================
        function carregarDados() {
            const todosDados = storage.get('dados');
            const dadosMes = todosDados[mesSelecionado] || {receitas: [], despesas: [], investimentos: []};
            receitas = dadosMes.receitas || [];
            despesas = dadosMes.despesas || [];
            investimentos = dadosMes.investimentos || [];
            atualizarInterface();
        }

        function salvarDados() {
            const todosDados = storage.get('dados');
            todosDados[mesSelecionado] = {receitas, despesas, investimentos};
            storage.set('dados', todosDados);
        }

        function navegarMes(delta) {
            const [ano, mes] = mesSelecionado.split('-').map(Number);
            let novoMes = mes + delta;
            let novoAno = ano;
            if (novoMes > 12) { novoMes = 1; novoAno++; }
            if (novoMes < 1) { novoMes = 12; novoAno--; }
            mesSelecionado = `${novoAno}-${novoMes.toString().padStart(2,'0')}`;
            carregarDados();
        }

        function atualizarInterface() {
            // Header
            const [ano, mes] = mesSelecionado.split('-');
            document.getElementById('mesAtual').textContent = `${mesesNomes[mes-1]} ${ano}`;

            // KPIs
            const totalReceitas = receitas.reduce((s, r) => s + r.valor, 0);
            const totalDespesas = despesas.reduce((s, d) => s + d.valor, 0);
            const saldo = totalReceitas - totalDespesas;
            const poupanca = totalReceitas > 0 ? (saldo / totalReceitas * 100) : 0;
            const patrimonio = saldo + investimentos.reduce((s, i) => s + i.saldoAtual, 0);

            document.getElementById('saldoAtual').textContent = formatarReal(saldo);
            document.getElementById('taxaPoupanca').textContent = poupanca.toFixed(1) + '%';
            document.getElementById('patrimonioTotal').textContent = formatarReal(patrimonio);

            // Tabelas
            document.getElementById('tabelaReceitas').innerHTML = receitas.map((r, i) => `
                <tr>
                    <td>${r.data}</td>
                    <td>${r.descricao}</td>
                    <td>${formatarReal(r.valor)}</td>
                    <td>${r.tipo === 'salario' ? 'üíº Sal√°rio' : '‚≠ê Extra'}</td>
                    <td><button class="btn btn-danger" onclick="removerItem('receitas', ${i})">üóëÔ∏è</button></td>
                </tr>
            `).join('');

            document.getElementById('tabelaDespesas').innerHTML = despesas.map((d, i) => `
                <tr>
                    <td>${d.data}</td>
                    <td>${d.categoria}</td>
                    <td>${d.descricao}</td>
                    <td>${formatarReal(d.valor)}</td>
                    <td><button class="btn btn-danger" onclick="removerItem('despesas', ${i})">üóëÔ∏è</button></td>
                </tr>
            `).join('');

            document.getElementById('tabelaInvestimentos').innerHTML = investimentos.map((inv, i) => {
                const projetado = inv.saldoAtual * Math.pow(1 + inv.rentabilidade / 100, 1);
                return `
                    <tr>
                        <td>${inv.tipo}</td>
                        <td>${formatarReal(inv.aporte)}</td>
                        <td>${inv.rentabilidade}%</td>
                        <td>${formatarReal(inv.saldoAtual)}</td>
                        <td>${formatarReal(projetado)}</td>
                        <td><button class="btn btn-danger" onclick="removerItem('investimentos', ${i})">üóëÔ∏è</button></td>
                    </tr>
                `;
            }).join('');

            // Datas padr√£o
            const primeiroDia = mesSelecionado + '-01';
            document.getElementById('dataReceita').value = primeiroDia;
            document.getElementById('dataDespesa').value = primeiroDia;
        }

        function formatarReal(valor) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor || 0);
        }

        // =====================================================
        // ADICIONAR ITENS
        // =====================================================
        function addReceita() {
            const data = document.getElementById('dataReceita').value;
            const desc = document.getElementById('descReceita').value.trim();
            const valor = parseFloat(document.getElementById('valorReceita').value);
            const tipo = document.getElementById('tipoReceita').value;

            if (data && desc && valor > 0 && data.startsWith(mesSelecionado)) {
                receitas.push({ data, descricao: desc, valor, tipo });
                salvarDados();
                atualizarInterface();
                limparFormulario('receitas');
                alert('‚úÖ Receita adicionada!');
            } else {
                alert('‚ùå Preencha todos os campos com data deste m√™s!');
            }
        }

        function addDespesa() {
            const data = document.getElementById('dataDespesa').value;
            const select = document.getElementById('categoriaDespesaSelect');
            const custom = document.getElementById('categoriaCustom');
            const categoria = (select.value || custom.value || '').trim();
            const desc = document.getElementById('descDespesa').value.trim();
            const valor = parseFloat(document.getElementById('valorDespesa').value);

            if (data && categoria && desc && valor > 0 && data.startsWith(mesSelecionado)) {
                despesas.push({ data, categoria: categoria.toLowerCase(), descricao: desc, valor });
                salvarDados();
                atualizarInterface();
                limparFormulario('despesas');
                alert(`‚úÖ Despesa "${categoria}" adicionada!`);
            } else {
                alert('‚ùå Todos os campos obrigat√≥rios + data deste m√™s!');
            }
        }

        function addInvestimento() {
            const tipo = document.getElementById('tipoInvestimento').value;
            const aporte = parseFloat(document.getElementById('aporteInvestimento').value);
            const rentabilidade = parseFloat(document.getElementById('rentabilidade').value);
            const saldoAtual = parseFloat(document.getElementById('saldoAtualInv').value);

            if (tipo && aporte > 0 && rentabilidade >= 0 && saldoAtual > 0) {
                investimentos.push({ tipo, aporte, rentabilidade, saldoAtual });
                salvarDados();
                atualizarInterface();
                limparFormulario('investimentos');
                alert('‚úÖ Investimento adicionado!');
            } else {
                alert('‚ùå Preencha todos os campos corretamente!');
            }
        }

        function toggleCustomCategoria() {
            const select = document.getElementById('categoriaDespesaSelect');
            const custom = document.getElementById('categoriaCustom');
            custom.style.display = select.value === '' ? 'block' : 'none';
            if (select.value === '') custom.focus();
        }

        function limparFormulario(tipo) {
            if (tipo === 'receitas') {
                document.getElementById('dataReceita').value = mesSelecionado + '-01';
                document.getElementById('descReceita').value = '';
                document.getElementById('valorReceita').value = '';
            } else if (tipo === 'despesas') {
                document.getElementById('dataDespesa').value = mesSelecionado + '-01';
                document.getElementById('descDespesa').value = '';
                document.getElementById('valorDespesa').value = '';
                document.getElementById('categoriaDespesaSelect').value = '';
                document.getElementById('categoriaCustom').value = '';
                document.getElementById('categoriaCustom').style.display = 'none';
            } else if (tipo === 'investimentos') {
                document.querySelectorAll('#investimentos input, #investimentos select').forEach(el => el.value = '');
            }
        }

        function removerItem(tipo, index) {
            if (confirm('Remover este item?')) {
                if (tipo === 'receitas') receitas.splice(index, 1);
                else if (tipo === 'despesas') despesas.splice(index, 1);
                else investimentos.splice(index, 1);
                salvarDados();
                atualizarInterface();
            }
        }

        function showTab(nomeTab) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(nomeTab).classList.add('active');
            event.target.classList.add('active');
        }

        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('themeBtn').textContent = isDark ? '‚òÄÔ∏è Light' : 'üåô Dark';
        }

        function exportCSV() {
            const csv = [
                ['TIPO,M√äS,DATA,DESCRI√á√ÉO,VALOR,CATEGORIA'],
                ...receitas.map(r => [`RECEITA,${mesSelecionado},${r.data},"${r.descricao}",${r.valor},"${r.tipo}"`]),
                ...despesas.map(d => [`DESPESA,${mesSelecionado},${d.data},"${d.descricao}",${d.valor},"${d.categoria}"`]),
                ...investimentos.map(i => [`INVESTIMENTO,${mesSelecionado},,"${i.tipo}",${i.saldoAtual},"${i.rentabilidade}%"`])
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `financas_${mesSelecionado}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function resetData() {
            if (confirm('‚ö†Ô∏è APAGAR TODOS OS DADOS? Estoque + iPhone + PC')) {
                storage.set('dados', {});
                carregarDados();
                alert('üóëÔ∏è Tudo resetado!');
            }
        }

        // =====================================================
        // INICIALIZA√á√ÉO
        // =====================================================
        document.addEventListener('DOMContentLoaded', function() {
            carregarDados();
        });
    </script>
</body>
</html>
