<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Wesley FinanÃ§as</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--bg:#f8fafc;--card:#fff;--text:#0f172a;--accent:#2563eb;
--success:#16a34a;--danger:#dc2626;--warning:#ca8a04;--border:#e2e8f0;
--radius:16px;
}
[data-theme="dark"]{
--bg:#0b0e14;--card:#151b25;--text:#f1f5f9;--border:#2d3748;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
font-family:system-ui;
background:var(--bg);
color:var(--text);
padding-bottom:120px;
}
.container{padding:15px}
.card{
background:var(--card);
border:1px solid var(--border);
border-radius:var(--radius);
padding:20px;
margin-bottom:20px;
}
.hidden{display:none}
.show{display:block}

.is-income{color:var(--success);font-weight:700}
.is-expense{color:var(--danger);font-weight:700}

.bottom-nav{
position:fixed;
bottom:0;left:0;width:100%;
display:grid;
grid-template-columns:repeat(6,1fr);
background:var(--card);
border-top:1px solid var(--border);
}
.nav-icon{
padding:8px;
background:none;
border:none;
opacity:.4;
font-size:.7rem;
}
.nav-icon.active{opacity:1;color:var(--accent)}
.nav-emoji{font-size:1.4rem}

#lock-overlay{
position:fixed;
inset:0;
background:var(--bg);
display:none;
align-items:center;
justify-content:center;
flex-direction:column;
z-index:9999;
}
#lock-overlay.active{display:flex}
.lock-input{
font-size:2rem;
letter-spacing:10px;
width:200px;
text-align:center;
padding:10px;
}
</style>
</head>

<body data-theme="light">

<div id="lock-overlay">
<h2>ðŸ”’ Bloqueado</h2>
<input id="pin-input" class="lock-input" maxlength="4" type="tel">
<button onclick="unlockApp()">Entrar</button>
<p id="lock-msg" style="color:red"></p>
</div>

<div class="container">

<h2>Wesley FinanÃ§as</h2>

<div id="view-dash" class="show">
<div class="card">
<h3>Saldo</h3>
<div id="kpi-saldo">---</div>
<p>Receitas: <span id="kpi-receitas"></span></p>
<p>Despesas: <span id="kpi-despesas"></span></p>
</div>

<div class="card">
<canvas id="grafico-cat"></canvas>
</div>
</div>

<div id="view-list" class="hidden">
<div class="card">
<input id="search-bar" placeholder="Buscar..." onkeyup="renderExtrato()">
<div id="lista-transacoes"></div>
</div>
</div>

</div>

<nav class="bottom-nav">
<button class="nav-icon active" onclick="navTo('view-dash',this)">
<span class="nav-emoji">ðŸ“Š</span>Dash
</button>
<button class="nav-icon" onclick="navTo('view-list',this)">
<span class="nav-emoji">ðŸ“‘</span>Extrato
</button>
</nav>

<script>
const CATEGORIAS=["Moradia","AlimentaÃ§Ã£o","Transporte","Lazer","Outros"]
let db=JSON.parse(localStorage.getItem("fin"))||{}
let curMonth=new Date().toISOString().slice(0,7)
let privacy=localStorage.getItem("privacy")==="true"
let pin=localStorage.getItem("pin")
let chart=null

function getM(){
if(!db[curMonth])db[curMonth]={t:[]}
return db[curMonth]
}
function save(){localStorage.setItem("fin",JSON.stringify(db))}

function fmt(v){
if(privacy)return"ðŸ™ˆ"
return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})
}

function navTo(id,btn){
document.querySelectorAll("[id^='view-']").forEach(v=>v.classList.add("hidden"))
document.getElementById(id).classList.remove("hidden")
document.querySelectorAll(".nav-icon").forEach(b=>b.classList.remove("active"))
btn.classList.add("active")
}

function render(){
const m=getM()
const rec=m.t.filter(x=>x.type==="receita").reduce((a,b)=>a+b.val,0)
const desp=m.t.filter(x=>x.type==="despesa").reduce((a,b)=>a+b.val,0)

document.getElementById("kpi-saldo").innerText=fmt(rec-desp)
document.getElementById("kpi-receitas").innerText=fmt(rec)
document.getElementById("kpi-despesas").innerText=fmt(desp)

const cats={}
m.t.filter(x=>x.type==="despesa").forEach(x=>{
cats[x.cat]=(cats[x.cat]||0)+x.val
})

if(chart)chart.destroy()
chart=new Chart(document.getElementById("grafico-cat"),{
type:"doughnut",
data:{
labels:Object.keys(cats),
datasets:[{
data:Object.values(cats),
backgroundColor:Object.keys(cats).map((_,i)=>`hsl(${i*60},70%,60%)`)
}]
}
})

renderExtrato()
}

function renderExtrato(){
const el=document.getElementById("lista-transacoes")
if(!el)return
el.innerHTML=""
const q=(document.getElementById("search-bar")?.value||"").toLowerCase()
getM().t
.filter(x=>x.desc.toLowerCase().includes(q))
.forEach(x=>{
el.innerHTML+=`
<div>
${x.desc}
<span class="${x.type==="receita"?"is-income":"is-expense"}">
${fmt(x.val)}
</span>
</div>`
})
}

function unlockApp(){
const i=document.getElementById("pin-input")
if(i.value===pin){
document.getElementById("lock-overlay").classList.remove("active")
i.value=""
}else{
document.getElementById("lock-msg").innerText="Senha incorreta"
i.value=""
}
}

if(pin)document.getElementById("lock-overlay").classList.add("active")
render()
</script>
</body>
</html>
